## UMP Bot ‚Äî Telegram‚Äë–±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¢–° –≤ –ø–∞—Ä–∫–∞—Ö (–¢–ó + —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è)

### 1) –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Telegram‚Äë–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **—Å–ø–∏—Å–∫–∏ –±–æ—Ä—Ç/–¥–µ–ø–æ‚Äë–Ω–æ–º–µ—Ä–æ–≤ –¢–°** (–≤—Ä—É—á–Ω—É—é –∫–æ–º–∞–Ω–¥–æ–π –∏–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏),
- –ø–æ–ª—É—á–∞–µ—Ç –ø–æ –Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ UMP (–ø–æ–∑–∏—Ü–∏—è/—Å—Ç–∞—Ç—É—Å),
- —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç **–∫–∞—Ä—Ç—É –ø–∞—Ä–∫–∞** (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) —Å —Ç–æ—á–∫–∞–º–∏ –¢–°,
- –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∫ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –¢–°,
- –¥–∞—ë—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–æ —Ñ–∏–ª–∏–∞–ª—É (–æ—à–∏–±–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è),
- —Å–æ–¥–µ—Ä–∂–∏—Ç **–∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å** (–≤–Ω—É—Ç—Ä–∏ Telegram) –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞.

### 2) –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø
- **–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞–º–∏ –±–æ—Ç–∞ –≤ —Ä–∞–º–∫–∞—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞.
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: **—Ç–æ–ª—å–∫–æ Telegram user id `<id>>`**. –ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/admin` –∏ –∫–Ω–æ–ø–∫–∞–º –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏.

#### 2.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É
–î–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_ALLOWED_USERS`.
- –ï—Å–ª–∏ `TELEGRAM_ALLOWED_USERS` **–ø—É—Å—Ç–∞—è** ‚Äî –¥–æ—Å—Ç—É–ø **–æ—Ç–∫—Ä—ã—Ç –≤—Å–µ–º**.
- –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–º user id.

> –ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `TELEGRAM_ALLOWED_USERS`: –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ** `<id>>`.

### 3) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—á—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç)

#### 3.1 –ö–æ–º–∞–Ω–¥—ã
- **`/start`** ‚Äî —Å—Ç–∞—Ä—Ç, –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–∫–µ–Ω–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- **`/help`** ‚Äî —Å–ø—Ä–∞–≤–∫–∞.
- **`/login`** ‚Äî –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ UMP (–ª–æ–≥–∏–Ω ‚Üí –ø–∞—Ä–æ–ª—å).
- **`/parks`** ‚Äî –≤—ã–±–æ—Ä –ø–∞—Ä–∫–∞ —á–µ—Ä–µ–∑ inline‚Äë–∫–Ω–æ–ø–∫–∏.
- **`/status <–Ω–æ–º–µ—Ä>`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¢–°.
- **`/map <–Ω–æ–º–µ—Ä1> <–Ω–æ–º–µ—Ä2> ...`** ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ —è–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –Ω–æ–º–µ—Ä–∞–º.
- **–¢–µ–∫—Å—Ç –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã** ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ ¬´–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –Ω–æ–º–µ—Ä–∞¬ª –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å —Ä–∞—Å–∫—Ä–∞—Å–∫–æ–π.
- **`/diag <—Ñ–∏–ª–∏–∞–ª>`** ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∏–ª–∏–∞–ª—É (–æ—à–∏–±–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è).
- **`/test`** ‚Äî —Å–ª—É–∂–µ–±–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏/—Ñ–∞–π–ª–æ–≤/—Ç–æ–∫–µ–Ω–∞.
- **`/admin`** ‚Äî –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ `825719797`).

#### 3.2 –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

##### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ø–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç `/start`.
2) –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ UMP –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç ‚Äî –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.
3) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç `/login`.
4) –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ª–æ–≥–∏–Ω UMP, –∑–∞—Ç–µ–º –ø–∞—Ä–æ–ª—å.
5) –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞:
   - —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `var/user_tokens/<user_id>_token.txt`,
   - cookies —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `var/user_cookies/<user_id>_cookies.txt`,
   - —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `var/user_creds/<user_id>_creds.json` (–¥–ª—è –∞–≤—Ç–æ–ª–æ–≥–∏–Ω–∞).

##### –°—Ü–µ–Ω–∞—Ä–∏–π B: –∫–∞—Ä—Ç–∞ –ø–æ —Å–ø–∏—Å–∫—É –Ω–æ–º–µ—Ä–æ–≤
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `/map 6683 6719 6306`.
2) –ë–æ—Ç:
   - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø,
   - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç UMP‚Äë—Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
   - –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä–∞,
   - –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –¢–°,
   - —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∫–∞—Ä—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

–í–∞–∂–Ω–æ: `/map` **–±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤** –Ω–µ —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –Ω–æ–º–µ—Ä–æ–≤. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –±–æ—Ç –ø—Ä–æ—Å–∏—Ç —É–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã.

##### –°—Ü–µ–Ω–∞—Ä–∏–π C: –∫–∞—Ä—Ç–∞ –ø–æ —Ç–µ–∫—Å—Ç—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç (–±–µ–∑ –∫–æ–º–∞–Ω–¥—ã), –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
–ó–∞—è–≤–∫–∏ Redmine:
6510
6241

–¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏:
6719
6684
```

2) –ë–æ—Ç:
   - –ø–∞—Ä—Å–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–Ω–æ–º–µ—Ä–∞,
   - —Å—Ç—Ä–æ–∏—Ç —Ü–≤–µ—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π,
   - —Å—Ç—Ä–æ–∏—Ç –∫–∞—Ä—Ç—É —Å —Ä–∞—Å–∫—Ä–∞—Å–∫–æ–π —Ç–æ—á–µ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º,
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

##### –°—Ü–µ–Ω–∞—Ä–∏–π D: —Å—Ç–∞—Ç—É—Å –¢–°
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `/status 6569`.
2) –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω, –ø—Ä–∏ 401 –ø—ã—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–ª–æ–≥–∏–Ω –ø–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –∫—Ä–µ–¥–∞–º.
3) –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å ¬´–≤ –ø–∞—Ä–∫–µ/–≤–Ω–µ –ø–∞—Ä–∫–∞¬ª, –ø–∞—Ä–∫, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –≤—Ä–µ–º—è.

##### –°—Ü–µ–Ω–∞—Ä–∏–π E: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ñ–∏–ª–∏–∞–ª–∞
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `/diag –ï–∫–∞—Ç–µ—Ä–∏–Ω–∏–Ω—Å–∫–∏–π`.
2) –ë–æ—Ç:
   - —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–º—è —Ñ–∏–ª–∏–∞–ª–∞ —Å id —á–µ—Ä–µ–∑ `UMP_BRANCH_MAP`,
   - –ø–æ–ª—É—á–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ,
   - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç/—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç ¬´–∫—Ä–∞—Å–Ω—ã–µ¬ª –ø—Ä–æ–±–ª–µ–º—ã,
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### 4) –ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ `<id>`)
–ö–æ–º–∞–Ω–¥–∞: **`/admin`**.

–ö–Ω–æ–ø–∫–∏:
- **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π –≤ –ø–∞–º—è—Ç–∏, –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–∞—Ä–∫, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤/–∫—É–∫–æ–≤/–∫—Ä–µ–¥–æ–≤/–º–µ—Ç–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞.
- **üîë –¢–æ–∫–µ–Ω—ã/—Ñ–∞–π–ª—ã**: –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö env (–±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤), —Å–≤–æ–¥–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º —Ç–æ–∫–µ–Ω–æ–≤/–∫—É–∫–æ–≤/–∫—Ä–µ–¥–æ–≤.
- **üßæ –õ–æ–≥–∏ (tail)**:
  - —á–∏—Ç–∞–µ—Ç –ª–æ–≥‚Äë—Ñ–∞–π–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/ump_bot.log`, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è `UMP_BOT_LOG_FILE`),
  - –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∑—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ `journalctl -u ump-bot` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ).
- **üì¶ –û–∫—Ä—É–∂–µ–Ω–∏–µ**: Python/OS, hostname, docker‚Äë–¥–µ—Ç–µ–∫—Ç, uptime (–µ—Å–ª–∏ –µ—Å—Ç—å `/proc/uptime`), loadavg, –¥–∏—Å–∫, `CACHE_DIR`, —Å—Ç–∞—Ç—É—Å `systemctl is-active ump-bot` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ).
- **üåê UMP healthcheck**: –±—ã—Å—Ç—Ä—ã–π HTTP‚Äë–∑–∞–ø—Ä–æ—Å –∫ `UMP_BASE_URL`.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –≤ Docker‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –æ–±—ã—á–Ω–æ **–Ω–µ—Ç systemd/journalctl**, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `docker compose logs`.

### 5) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ)

#### 5.1 –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
- `bot.py` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏.
- `src/ump_bot/telegram_bot.py` ‚Äî —Å–æ–∑–¥–∞—ë—Ç `Application` (python‚Äëtelegram‚Äëbot) –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç handlers.

#### 5.2 –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
- `src/ump_bot/handlers/*` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ Telegram.
- `src/ump_bot/services/auth.py` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ UMP, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤/–∫—Ä–µ–¥–æ–≤, –∞–≤—Ç–æ–ª–æ–≥–∏–Ω.
- `src/ump_bot/infra/login_token.py` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ª–æ–≥–∏–Ω –≤ UMP (`/api/v1/auth/login`).
- `src/ump_bot/services/map.py` + `src/ump_bot/infra/render_map.py` ‚Äî —Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç—ã (—Ç–∞–π–ª—ã, —Ç–æ—á–∫–∏, —Ü–≤–µ—Ç–∞).
- `src/ump_bot/infra/otbivka.py` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö/–ø–æ–∑–∏—Ü–∏–∏ –¢–° –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∫–æ–≤.
- `src/ump_bot/diagnostic.py` / `src/ump_bot/services/diagnostic.py` ‚Äî –ª–æ–≥–∏–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º.
- `src/ump_bot/config/*` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —á—Ç–µ–Ω–∏–µ `.env`, –¥–µ—Ñ–æ–ª—Ç—ã.

#### 5.3 –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å—ë –ª–µ–∂–∏—Ç –≤ `var/` (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤ `.gitignore`).
- `var/user_tokens/<user_id>_token.txt`
- `var/user_cookies/<user_id>_cookies.txt`
- `var/user_creds/<user_id>_creds.json`
- `var/user_meta/*` (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)
- `var/cache` –∏ –¥—Ä. –∫—ç—à–∏ (—Å–º. –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∏–∂–µ)

### 6) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `.env` (pydantic‚Äësettings).

#### 6.1 Telegram
- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.
- `TELEGRAM_ALLOWED_USERS` ‚Äî —Å–ø–∏—Å–æ–∫ user id —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–ø—É—Å—Ç–æ = –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç).

#### 6.2 UMP
- `UMP_BASE_URL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://ump.piteravto.ru`)
- `REQUEST_TIMEOUT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `20`)
- `UMP_TIMEZONE_OFFSET` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `180`)
- `UMP_USER_ID` ‚Äî user_id –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏–∑–≤–ª–µ—á—å –∏–∑ —Ç–æ–∫–µ–Ω–∞).
- `UMP_BRANCH_MAP` ‚Äî –∫–∞—Ä—Ç–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤ –¥–ª—è `/diag`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
UMP_BRANCH_MAP={"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∏–Ω—Å–∫–∏–π":1382,"...":1234}
```

> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å `UMP_USER` / `UMP_PASS` ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è CLI‚Äë–≤—Ö–æ–¥–æ–º `src/ump_bot/infra/login_token.py` (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ `/login`).

#### 6.3 –§–∞–π–ª—ã/–∫–∞—Ç–∞–ª–æ–≥–∏
- `PARKS_FILE` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `src/ump_bot/data/parks.json`)
- `VEHICLES_FILE` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `src/ump_bot/data/vehicles.sample.txt`)
- `USER_TOKEN_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/user_tokens`)
- `USER_COOKIES_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/user_cookies`)
- `USER_CREDS_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/user_creds`)
- `USER_META_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/user_meta`)

#### 6.4 –ö–∞—Ä—Ç–∞
- `MAP_PROVIDER` ‚Äî URL —Ç–∞–π–ª–æ–≤ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `{apikey}`)
- `MAPTILER_API_KEY` ‚Äî –∫–ª—é—á –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `MAP_USER_AGENT`, `MAP_REFERER`
- `MAP_CACHE_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/tile_cache`)
- `MAP_OUT_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `out`)
- `MAP_TPS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3.0`) ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–π–ª–æ–≤
- `MAP_ZOOM` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `17`)
- `MAX_IMAGE_SIZE_MB` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `10`)

#### 6.5 –ö—ç—à/—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- `CACHE_DIR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `var/cache`)
- `CACHE_TTL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `120`)
- `ANTI_FLAP_GRACE_M` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3.0`)

#### 6.6 –õ–æ–≥–∏
- `LOG_LEVEL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `INFO`)
- `UMP_BOT_LOG_FILE` ‚Äî –ø—É—Ç—å –∫ –ª–æ–≥‚Äë—Ñ–∞–π–ª—É –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

### 7) –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é
- Python (–ª–æ–∫–∞–ª—å–Ω–æ): —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è (–ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `python-telegram-bot==21.*`).
- Docker: –æ–±—Ä–∞–∑ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ `python:3.11-slim`.

### 8) –ó–∞–ø—É—Å–∫

#### 8.1 –õ–æ–∫–∞–ª—å–Ω–æ
```bash
python3 -m venv .venv
./.venv/bin/pip install -r requirements.txt

# —Å–æ–∑–¥–∞—Ç—å .env (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)
./.venv/bin/python bot.py
```

#### 8.2 Docker
```bash
docker compose up -d --build
# –ª–æ–≥–∏
docker compose logs -f --tail=200
```

#### 8.3 systemd
–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä `ump-bot.service`.
- —Å—Ç–∞—Ç—É—Å: `systemctl status ump-bot`
- –ª–æ–≥–∏: `journalctl -u ump-bot -f`

### 9) –ü—Ä–∏–º–µ—Ä `.env` (—à–∞–±–ª–æ–Ω)
```bash
# Telegram
TELEGRAM_BOT_TOKEN=
TELEGRAM_ALLOWED_USERS=

# UMP
UMP_BASE_URL=http://ump.piteravto.ru
REQUEST_TIMEOUT=20
UMP_TIMEZONE_OFFSET=180
# UMP_USER_ID=...
# UMP_BRANCH_MAP={"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∏–Ω—Å–∫–∏–π":1382}

# –§–∞–π–ª—ã
PARKS_FILE=src/ump_bot/data/parks.json
VEHICLES_FILE=src/ump_bot/data/vehicles.sample.txt

# –ö–∞—Ä—Ç–∞ (–ø—Ä–∏–º–µ—Ä –¥–ª—è MapTiler)
MAPTILER_API_KEY=
MAP_PROVIDER=https://api.maptiler.com/maps/streets-v2/256/{z}/{x}/{y}.png?key={apikey}
MAP_ZOOM=17
MAP_TPS=3
MAP_CACHE_DIR=var/tile_cache
MAP_OUT_DIR=out
MAX_IMAGE_SIZE_MB=10
# MAP_USER_AGENT=UMPBot/1.0
# MAP_REFERER=

# –õ–æ–≥–∏ (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —á–∏—Ç–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞ –≤ –∞–¥–º–∏–Ω–∫–µ)
# UMP_BOT_LOG_FILE=var/ump_bot.log

LOG_LEVEL=INFO
```

### 10) –¢–µ—Å—Ç—ã
```bash
./.venv/bin/python -m pytest -q
```

### 11) –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å `.env` –≤ git; –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø `TELEGRAM_ALLOWED_USERS`; –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –∫—Ä–µ–¥—ã UMP —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `var/user_creds`.
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å**: –ª–æ–≥–∏ —á–µ—Ä–µ–∑ stdout/stderr (Docker/systemd), –ª–∏–±–æ –≤ —Ñ–∞–π–ª –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**: `bot.py` –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏.

### 12) –ì—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (—á—Ç–æ –ø—Ä–æ–µ–∫—Ç –ù–ï –¥–µ–ª–∞–µ—Ç)
- –ù–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ–±‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–≤—Å—ë —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram).
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å UMP (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–∏/UMP).
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î (—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –≤ `var/`).
