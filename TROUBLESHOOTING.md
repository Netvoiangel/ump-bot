# Устранение неполадок

## Проблема: `/map` без аргументов показывает ТС из файла

**Причина:** На сервере старая версия кода.

**Решение:**
1. Убедись, что обновил код на сервере:
   ```bash
   git pull origin feature  # или main
   ```
2. Перезапусти бота:
   ```bash
   # Docker
   docker-compose restart
   
   # или systemd
   sudo systemctl restart ump-bot
   ```
3. Проверь, что `/map` без аргументов выдает ошибку:
   ```
   ❌ Укажите номера ТС. Пример: /map 6683 6719 6306
   ```

## Проблема: Все точки на карте красные (default цвет)

**Причина:** `color_map` не создается или не передается в `render_parks_with_vehicles`.

**Проверка:**
1. Отправь текст с категориями в бота
2. Проверь логи на наличие:
   ```
   color_map создан: X ТС с цветами
   Примеры цветов: [('6510', ('#4dabf7', '#339af0')), ...]
   [DEBUG] color_map передан: X ТС
   ```

**Если в логах нет этих сообщений:**
- Код не обновлен на сервере
- Или логирование не работает

**Решение:**
1. Обнови код на сервере
2. Перезапусти бота
3. Проверь логи снова

## Проблема: Цвета не совпадают с категориями

**Проверка:**
1. В логах должно быть:
   ```
   Категории: ['Заявки Redmine', 'Текущие задачи', 'Проверка ГК, маршрут 54']
     Заявки Redmine: ['6510', '6241']
     Текущие задачи: ['6719', '6684']
   ```
2. И далее:
   ```
   build_color_map_from_sections: обрабатываю 3 категорий
     Категория 'Заявки Redmine': цвет #4dabf7, ТС: ['6510', '6241']
   ```

**Если категории не распознаются:**
- Проверь, что в тексте есть двоеточие после категории (или категория без цифр)
- Проверь регистр (не важен, но лучше как в примере)

## Быстрая проверка

```bash
# 1. Проверь версию кода
git log -1 --oneline

# 2. Проверь логи бота
docker-compose logs -f ump-bot
# или
journalctl -u ump-bot -f

# 3. Отправь тестовое сообщение в бота:
# Заявки Redmine:
# 6510
# 
# Текущие задачи:
# 6719

# 4. Проверь логи на наличие:
# - "color_map создан"
# - "[DEBUG] color_map передан"
# - "ТС 6510: цвет #4dabf7"
```

